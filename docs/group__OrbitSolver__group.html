<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>poet: Orbit Solver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">poet
   &#160;<span id="projectnumber">unspecified</span>
   </div>
   <div id="projectbrief">Evolve orbits under tides</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__OrbitSolver__group.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Orbit Solver</div>  </div>
</div><!--header-->
<div class="contents">

<p>Calculates the orbital evolution under tides.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:ExternalStoppingConditions_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ExternalStoppingConditions_8h.html">ExternalStoppingConditions.h</a></td></tr>
<tr class="memdesc:ExternalStoppingConditions_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Users can define any stopping condition they wish the evolution to search for in this file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:StopHistoryInterval_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="StopHistoryInterval_8h.html">StopHistoryInterval.h</a></td></tr>
<tr class="memdesc:StopHistoryInterval_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declares the StopHistoryInterval class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:OrbitSolver_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="OrbitSolver_8cpp.html">OrbitSolver.cpp</a></td></tr>
<tr class="memdesc:OrbitSolver_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements some of the members of the OrbitSolver class, the various stopping conditions and a number of other classes used while calculating the orbital evolution. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:StopInformation_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="StopInformation_8h.html">StopInformation.h</a></td></tr>
<tr class="memdesc:StopInformation_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declares the StopInformation class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:OrbitSolver_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="OrbitSolver_8h.html">OrbitSolver.h</a></td></tr>
<tr class="memdesc:OrbitSolver_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the OrbitSolver class, the various stopping conditions and a number of other classes used while calculating the orbital evolution. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:StoppingCondition_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="StoppingCondition_8cpp.html">StoppingCondition.cpp</a></td></tr>
<tr class="memdesc:StoppingCondition_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">The implementations of the various stopping condition methods. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:StopHistoryInterval_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="StopHistoryInterval_8cpp.html">StopHistoryInterval.cpp</a></td></tr>
<tr class="memdesc:StopHistoryInterval_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declares some of the methods of the StopHistoryInterval class. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:StoppingCondition_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="StoppingCondition_8h.html">StoppingCondition.h</a></td></tr>
<tr class="memdesc:StoppingCondition_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the various stopping conditions needed by OrbitSolver. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1RotFastCondition.html">Evolve::RotFastCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Satisfied when a zone is rotating faster than a threshold.  <a href="classEvolve_1_1RotFastCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1CombinedStoppingCondition.html">Evolve::CombinedStoppingCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class combining the the outputs of multiple stopping conditions.  <a href="classEvolve_1_1CombinedStoppingCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1SecondaryDeathCondition.html">Evolve::SecondaryDeathCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Satisfied when the planet enters below either the roche sphere or the stellar photosphere.  <a href="classEvolve_1_1SecondaryDeathCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1BreakLockCondition.html">Evolve::BreakLockCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Satisfied when the maximum tidal torque that the planet can exert on the star is no longer sufficient to keep the lock.  <a href="classEvolve_1_1BreakLockCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1StopHistoryInterval.html">Evolve::StopHistoryInterval</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A collection of accepted and discarded evolution steps which contain some reason to stop.  <a href="classEvolve_1_1StopHistoryInterval.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1StopInformation.html">Evolve::StopInformation</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The information about why and where the evolution should stop.  <a href="classEvolve_1_1StopInformation.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1ExtremumInformation.html">Evolve::ExtremumInformation</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Infomation about an extremum of a function.  <a href="classEvolve_1_1ExtremumInformation.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1OrbitSolver.html">Evolve::OrbitSolver</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solves the system of ODEs describing the evolution of a single planet around a single star.  <a href="classEvolve_1_1OrbitSolver.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1StoppingCondition.html">Evolve::StoppingCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A base class for all stopping conditions.  <a href="classEvolve_1_1StoppingCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1NoStopCondition.html">Evolve::NoStopCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A stopping condition that is never satisfied.  <a href="classEvolve_1_1NoStopCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classEvolve_1_1ExternalStoppingCondition.html">Evolve::ExternalStoppingCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A base class for all external stopping conditions.  <a href="classEvolve_1_1ExternalStoppingCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classStar_1_1WindSaturationCondition.html">Star::WindSaturationCondition</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Satisfied when the surface zone of a body is spinning at exactly the wind saturation frequency.  <a href="classStar_1_1WindSaturationCondition.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Calculates the orbital evolution under tides. </p>
<h1><a class="anchor" id="evolution"></a>
Orbital Evolution</h1>
<p>The general evolution equations that govern the tidal evolution of a planet around a star in a circular orbit aligned with the stellar rotation are given by:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray} \frac{da}{dt}&amp;=&amp;\mathrm{sign}(\omega_\mathrm{conv}-\omega_\mathrm{orb}) \frac{9}{2}\sqrt{\frac{G}{aM_*}}\left( \frac{R_*}{a} \right)^5\frac{m_p}{Q_*} \\ \left(\frac{dL}{dt}\right)_\mathrm{tide}&amp;=&amp;-\frac{1}{2}m_p M_*\sqrt{\frac{G}{a(M_*+m_p)}}\frac{da}{dt} \\ \left(\frac{dL}{dt}\right)_\mathrm{wind}&amp;=&amp; -K\omega_\mathrm{conv} \min(\omega_\mathrm{conv}, \omega_\mathrm{sat})^2 \left( \frac{R_*}{R_\odot}\right)^{1/2} \left( \frac{M_*}{M_\odot} \right)^{-1/2} \\ \frac{dL_\mathrm{conv}}{dt}&amp;=&amp;\frac{\Delta L}{\tau_c} - \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} + \left(\frac{dL}{dt}\right)_\mathrm{wind} + \left(\frac{dL}{dt}\right)_\mathrm{tide} \\ \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ \Delta L&amp;=&amp;\frac{I_\mathrm{conv}L_\mathrm{rad}- I_\mathrm{rad}L_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \end{eqnarray}" src="form_82.png"/>
</p>
<p>Where:</p><ul>
<li><img class="formulaInl" alt="$M_*$" src="form_83.png"/> is the mass of the star</li>
<li><img class="formulaInl" alt="$R_*$" src="form_84.png"/> is the radius of the star</li>
<li><img class="formulaInl" alt="$m_p$" src="form_85.png"/> is the mass of the planet</li>
<li><img class="formulaInl" alt="$Q_*$" src="form_86.png"/> is the tidal quality factor of the star, which is possibly dependent on the tidal frequency ( <img class="formulaInl" alt="$\omega_\mathrm{conv}-\omega_\mathrm{orb}$" src="form_87.png"/>)</li>
<li><img class="formulaInl" alt="$\mathrm{sign}(\omega_\mathrm{conv}-\omega_\mathrm{orb})$" src="form_88.png"/> takes the value 1 when the stellar convective zone is spinning faster than the planet and -1 when the reverse is true</li>
<li><img class="formulaInl" alt="$K$" src="form_89.png"/> is the proportionality constant, parametrizing the strength of the magnetic wind of the star.</li>
<li><img class="formulaInl" alt="$\omega_\mathrm{sat}$" src="form_90.png"/> is the wind saturation frequency</li>
<li><img class="formulaInl" alt="$I_\mathrm{conv}$" src="form_91.png"/> is the moment of inertia of the stellar convective zone</li>
<li><img class="formulaInl" alt="$L_\mathrm{conv}$" src="form_92.png"/> is the angular momentum of the stellar convective zone</li>
<li><img class="formulaInl" alt="$I_\mathrm{rad}$" src="form_93.png"/> is the moment of inertia of the stellar radiative core</li>
<li><img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/> is the angular momentum of the stellar radiative core</li>
<li><img class="formulaInl" alt="$\tau_c$" src="form_95.png"/> is the stellar core-envelope coupling timescale</li>
<li><img class="formulaInl" alt="$M_\mathrm{rad}$" src="form_96.png"/> is the mass of the stellar radiative core</li>
<li><img class="formulaInl" alt="$R_\mathrm{rad}$" src="form_97.png"/> is the radius of the radiative-convective boundary in the star</li>
<li><img class="formulaInl" alt="$\omega_\mathrm{conv}\equiv L_\mathrm{conv}/I_\mathrm{conv}$" src="form_98.png"/> is the angular frequency of the stellar convective zone.</li>
</ul>
<p>The following default values for the stellar rotation properties reproduce the present rotation rate of the Sun at the present age:</p><ul>
<li><img class="formulaInl" alt="$K=0.35\ \frac{M_{\odot}R_{\odot}^2 \mathrm{day}^2}{\mathrm{rad}^2\mathrm{Gyr}}$" src="form_99.png"/></li>
<li><img class="formulaInl" alt="$\omega_\mathrm{sat}=1.84\ \mathrm{rad}/\mathrm{day}$" src="form_100.png"/></li>
<li><img class="formulaInl" alt="$\tau_c=5\ \mathrm{Myr}$" src="form_101.png"/></li>
</ul>
<h1><a class="anchor" id="stop_cond"></a>
Stopping Conditions</h1>
<p>Because Equations 1 and 3 have discontinuities (when <img class="formulaInl" alt="$\omega_\mathrm{conv}=\omega_\mathrm{orb}$" src="form_102.png"/> for equation 1 and when <img class="formulaInl" alt="$\omega_\mathrm{conv}=\omega_\mathrm{sat}$" src="form_103.png"/>), it is beneficial to detect when the evolution goes through these discontinuities and ensure that it does not simply jump over such points, but lands on them (to some precision of course). Such special treatment of allows the evolution to be calculated both more accurately and more efficientlfy.</p>
<p>To see this, consider the discontinuity in Equation 1. Because the sign of the tidal evolution changes when the spin of the star goes through synchroneity with the orbit, it is possible to lock the system in a state where the two quantities are locked to each other. If we simply let the ODE solver handle this for us, it would result in tiny steps being taken, oscillating between super- and sub-synchronous rotation. If we go through the effort of detecting this and stopping the evolution precisely at the point where synchronous rotation is achieved, we can switch to a different system of differential equations that explicitly imposes the spin-orbit lock, getting rid of the oscillatory behavior in the evolution of the semimajor axis.</p>
<p>The spin-orbit lock may not persist indefinitely. The orbit continues to evolve since the system is losing angular momentum due to the stellar wind. Because of this, there may come a point when the tidal dissipation in the star cannot drain sufficient amount of angular momentum from the orbit to compensate for the wind loss and the extra spin up required of the star in order to match the shorter orbital period, at which point the evolution has to revert back to the non-locked equations.</p>
<p>Next, consider the discontinuity in Equation 3. Because in this case the rate of evolution of the convective angular momentum is not discontinuous, but its derivative is, the ODE solver can blindly jump over the <img class="formulaInl" alt="$\omega_\mathrm{conv}=\omega_\mathrm{sat}$" src="form_103.png"/> point resulting in the change from saturated to non-saturated wind (or vice-versa) happening later than it should. If on the other hand, we detect this and force the solver to land precisely on the critical point, the calculated evolution will be more precise.</p>
<p>In addition to the above discontinuities, we have several others, which are due to the fact that we may want to include parts of the evolution of the system before and after the planet is present.</p>
<p>In the present version of the code, we would like to start the evolution when the protoplanetary disk is still present, assuming that the stellar surface rotation is locked to the rotation rate of the inner edge of the disk. Then at some specified age, the disk is removed (releasing the surface rotation rate of the star from the lock) and replaced with a planet in a circular orbit, whose evolution we then follow to the point when either the star moves off the main-sequenc or the orbit shrinks so much that the planet is tidally destroyed or engulfed by the star. If the planet dies before the star, the angular momentum of the planetary orbit at the moment of death is added to the stellar convective zone and the subseqent rotational evolution of the star is followed until the end of its main sequence phase.</p>
<p>Finally, often various applications for which calculating the planet-star orbital evolution is necessary require detecting when some special conditions in the evolution are met.</p>
<p>In order to accomplish stopping the evolution when some condition is met, StoppingCondition objects have been introduced. Each Stopping Condition should be a quantity that varies smoothly with the evolution (continuous and continuously differentiable up to at least third order) and is zero exactly when the condition which should stop the evolution is met (see for example SynchronizedCondition, BreakLockCondition, PlanetDeathCondition).</p>
<p>It is possible for users to define external stopping conditions. This is accomplished by editing the files <a class="el" href="ExternalStoppingConditions_8h.html" title="Users can define any stopping condition they wish the evolution to search for in this file...">ExternalStoppingConditions.h</a> and <a class="el" href="ExternalStoppingConditions_8cpp.html">ExternalStoppingConditions.cpp</a>. The user needs to inherit a class from the #ExternalStoppingCondition class and define operator() for it, which should return a valarray of real values which vary smoothly with age and the orbital parameters and one of which is zero exactly for the evolution states that the evolution needs to meet precisely. If it is known, operator() should also overwrite an input derivatives valarray with the rate at which the stopping condition values change with age (per Gyr). For a more detailed description of the input arguments see #StoppingCondition::operator()(). <b>Recompliing the code is necessary after defining or changing external stopping conditions!</b></p>
<h1><a class="anchor" id="modes"></a>
Evolution Modes</h1>
<p>As discussed above, discontinuities in the evolution require switching between different systems of differential equations when some StoppingCondition is encountered. The system of differential equations to use at any given time is determined by an evolution mode (#EvolModeType) and the wind saturation state (#WindSaturationState).</p>
<p>The wind saturation state only affects how the following quantity is calculated: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left(\frac{dL_\mathrm{conv}}{dt}\right)_\mathrm{wind}=\left\{ \begin{array}{l@{\quad\mathrm{if}\quad}l} -K\omega_\mathrm{conv}^3 \left( \frac{R_*}{R_\odot}\right)^{1/2} \left( \frac{M_*}{M_\odot} \right)^{-1/2} &amp; \mathrm{NOT\_SATURATED}\\ -K\omega_\mathrm{conv} \min(\omega_\mathrm{conv}, \omega_\mathrm{sat})^2 \left( \frac{R_*}{R_\odot}\right)^{1/2} \left( \frac{M_*}{M_\odot} \right)^{-1/2} &amp; \mathrm{UNKNOWN}\\ -K\omega_\mathrm{conv} \omega_\mathrm{sat}^2 \left( \frac{R_*}{R_\odot}\right)^{1/2} \left( \frac{M_*}{M_\odot} \right)^{-1/2} &amp; \mathrm{SATURATED} \end{array} \right. \]" src="form_104.png"/>
</p>
<p>Depending on the evolution mode, the evolution is calculated using different sets of variables and equations governing their evolution.</p>
<h2><a class="anchor" id="LOCKED_TO_DISK"></a>
LOCKED_TO_DISK</h2>
<p>This is the evolution mode for a system for which the protoplanetary disk is still present. In this case, the spin of the surface convective zone is held at some prescribed constant value <img class="formulaInl" alt="$\omega_\mathrm{disk}$" src="form_105.png"/>, representing the orbital frequency of the inner edge of the protoplanetary disk, to which the stellar surface rotation is locked.</p>
<p>In this case, the only evolution variable is <img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/> and the equation governing its evolution is: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray} \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \Delta \\ L&amp;=&amp;\frac{I_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \left(L_\mathrm{rad}-I_\mathrm{rad}\omega_\mathrm{disk}\right) \end{eqnarray}" src="form_106.png"/>
</p>
<p>The evolution will switch out of this mode at a prescribed disk-dissipation age. The subsequent evolution mode is FAST_PLANET, LOCKED_TO_PLANET or SLOW_PLANET depending on the initial semimajor axis at which the planet appears.</p>
<h2><a class="anchor" id="FAST_PLANET"></a>
FAST_PLANET</h2>
<p>This is the evolution mode for a system in which the orbital period is shorter than the spin period of the stellar surface convective zone. In this case the evolution variables are: <img class="formulaInl" alt="$a^{6.5}$" src="form_107.png"/>, <img class="formulaInl" alt="$L_\mathrm{conv}$" src="form_92.png"/>, <img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/>, and the equations for their evolution are:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{da^{6.5}}{dt}&amp;=&amp; -\frac{9}{13}\sqrt{\frac{G}{M_*}}R_*^5\frac{m_p}{Q_*} \\ \left(\frac{dL_\mathrm{conv}}{dt}\right)_\mathrm{tide}&amp;=&amp;-\frac{1}{2}m_p M_*\sqrt{\frac{G}{a(M_*+m_p)}}\frac{da}{dt} \\ \frac{dL_\mathrm{conv}}{dt}&amp;=&amp;\frac{\Delta L}{\tau_c} - \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} + \left(\frac{dL}{dt}\right)_\mathrm{wind} + \left(\frac{dL}{dt}\right)_\mathrm{tide} \\ \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ \Delta L&amp;=&amp;\frac{I_\mathrm{conv}L_\mathrm{rad}- I_\mathrm{rad}L_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \end{eqnarray*}" src="form_108.png"/>
</p>
<p>The reason for using <img class="formulaInl" alt="$a^{6.5}$" src="form_107.png"/> instead of <img class="formulaInl" alt="$a$" src="form_109.png"/> as the evolution variable is evident from the first equation above. The rate at which <img class="formulaInl" alt="$a^{6.5}$" src="form_107.png"/> evolves is independent of <img class="formulaInl" alt="$a$" src="form_109.png"/>. In fact, for a constant <img class="formulaInl" alt="$Q_*$" src="form_86.png"/> it only changes due to <img class="formulaInl" alt="$R_*$" src="form_84.png"/> evolving. This allows the ODE solver to take much larger steps when the orbit has shrunk than would otherwise be possible.</p>
<p>This evolution mode can end in one of two ways:</p><ul>
<li>The orbit shrinks sufficiently to either be inside the star or inside the critical size when the planet gets destroyed by the tides from the star. In which case the subsequent evolution mode is NO_PLANET.</li>
<li>The spin period of the stellar surface convective zone matches the orbital period. In which case the subsequent evolution mode is either LOCKED_TO_PLANET or SLOW_PLANET, depending on whether the transfer of angular momentum due to tides is sufficient to keep the lock.</li>
</ul>
<h2><a class="anchor" id="LOCKED_TO_PLANET"></a>
LOCKED_TO_PLANET</h2>
<p>This is the evolution mode for a system in which the surface rotation of the star is held locked to the orbit by the dissipation of the stellar tides. The evolution variables are <img class="formulaInl" alt="$a$" src="form_109.png"/> and <img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/> and the equations: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{da}{dt}&amp;=&amp;2\frac{T - \dot{I}_\mathrm{conv}/a} {M_*m_p/(M_*+m_p) - 3I_\mathrm{conv}/a^2} \\ \left(\frac{dL}{dt}\right)_\mathrm{tide}&amp;=&amp;-\frac{1}{2}m_p M_*\sqrt{\frac{G}{a(M_*+m_p)}}\frac{da}{dt} \\ \left(\frac{dL}{dt}\right)_\mathrm{wind}&amp;=&amp; -K\omega_\mathrm{conv} \min(\omega_\mathrm{conv}, \omega_\mathrm{sat})^2 \left( \frac{R_*}{R_\odot}\right)^{1/2} \left( \frac{M_*}{M_\odot} \right)^{-1/2} \\ \left(\frac{dL}{dt}\right)_\mathrm{coup}&amp;=&amp; \frac{\Delta L}{\tau_c} - \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ T&amp;=&amp;\frac{a}{(M_*+m_p)G}\left[\left(\frac{dL}{dt}\right)_\mathrm{coup} + \left(\frac{dL}{dt}\right)_\mathrm{wind}\right] \\ \frac{dL_\mathrm{conv}}{dt}&amp;=&amp; \left(\frac{dL}{dt}\right)_\mathrm{coup} + \left(\frac{dL}{dt}\right)_\mathrm{wind} + \left(\frac{dL}{dt}\right)_\mathrm{tide} \\ \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ \Delta L&amp;=&amp;\frac{I_\mathrm{conv}L_\mathrm{rad}- I_\mathrm{rad}L_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \end{eqnarray*}" src="form_110.png"/>
</p>
<p>This evolution mode can end either by the planet dying or by the rate of transfer of angular momentum from the orbit to the star falling below what is required to keep the lock. In the first case, the subsequent evolution mode is NO_PLANET and in the other case it is either FAST_PLANET or SLOW_PLANET.</p>
<h2><a class="anchor" id="SLOW_PLANET"></a>
SLOW_PLANET</h2>
<p>This is the evolution mode for a system in which the orbital period is longer than the spin period of the stellar surface convective zone. In this case the evolution variables are: <img class="formulaInl" alt="$a^{6.5}$" src="form_107.png"/>, <img class="formulaInl" alt="$L_\mathrm{conv}$" src="form_92.png"/>, <img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/>, and the equations for their evolution are:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{da^{6.5}}{dt}&amp;=&amp; \frac{9}{13}\sqrt{\frac{G}{M_*}}R_*^5\frac{m_p}{Q_*} \\ \left(\frac{dL_\mathrm{conv}}{dt}\right)_\mathrm{tide}&amp;=&amp;-\frac{1}{2}m_p M_*\sqrt{\frac{G}{a(M_*+m_p)}}\frac{da}{dt} \\ \frac{dL_\mathrm{conv}}{dt}&amp;=&amp;\frac{\Delta L}{\tau_c} - \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} + \left(\frac{dL}{dt}\right)_\mathrm{wind} + \left(\frac{dL}{dt}\right)_\mathrm{tide} \\ \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ \Delta L&amp;=&amp;\frac{I_\mathrm{conv}L_\mathrm{rad}- I_\mathrm{rad}L_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \end{eqnarray*}" src="form_111.png"/>
</p>
<p>This evolution mode can end only if The spin period of the stellar surface convective zone matches the orbital period. In which case the subsequent evolution mode is either LOCKED_TO_PLANET or FAST_PLANET, depending on whether the transfer of angular momentum due to tides is sufficient to keep the lock.</p>
<h2><a class="anchor" id="NO_PLANET"></a>
NO_PLANET</h2>
<p>This is the evolution mode for a star without a planet in orbit and no proto-planetary disk. Usually this state is reached after the planet dies. The evolution variables are <img class="formulaInl" alt="$L_\mathrm{conv}$" src="form_92.png"/> and <img class="formulaInl" alt="$L_\mathrm{rad}$" src="form_94.png"/>, and their evolution is given by: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{dL_\mathrm{conv}}{dt}&amp;=&amp;\frac{\Delta L}{\tau_c} - \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} + \left(\frac{dL}{dt}\right)_\mathrm{wind} \\ \frac{dL_\mathrm{rad}}{dt}&amp;=&amp;-\frac{\Delta L}{\tau_c} + \frac{2}{3} R_\mathrm{rad}^2 \omega_\mathrm{conv} \frac{dM_\mathrm{rad}}{dt} \\ \Delta L&amp;=&amp;\frac{I_\mathrm{conv}L_\mathrm{rad}- I_\mathrm{rad}L_\mathrm{conv}}{I_\mathrm{conv}+I_\mathrm{rad}} \end{eqnarray*}" src="form_112.png"/>
</p>
<p>This evolution mode persists until the end of the star's lifetime. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Nov 16 2017 11:03:32 for poet by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
